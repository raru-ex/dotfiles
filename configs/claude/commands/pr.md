---
description: "プルリクエストの作成・更新を行うスラッシュコマンド。"
---

# プルリクエスト作成・更新タスク

プルリクエストを作成または更新するために以下の手順を実行してください：

## タスク

1. **現在のPR状態を確認**

```bash
gh pr view --json number,title,body,state,isDraft 2>/dev/null || echo "NO_PR"
```
- PRが既に存在する場合 → **更新フロー**へ
- PRが存在しない場合 → **新規作成フロー**へ

2. **ステージされていない変更の確認**

```bash
git status
```

自身が対応しているタスクで必要なものをステージに追加してください。

3. ブランチの確認

現在の作業ブランチを確認してください。
作業ブランチがmasterの場合には以下の手順で内容を確認してください。

```bash
 git log master..HEAD --oneline
 git diff master..HEAD --stat
 git diff master..HEAD
 ```

これにより、masterブランチから分岐した後のすべてのコミット、ファイル変更、実際のコード変更が表示されます。

作業ブランチがmaster以外の時には、そのブランチが今のタスクのために作成されたブランチか確認してください。
別の作業の後に継続して作業を行なっており、ブランチを新しく作成していない場合には新しくブランチを作成して、そのブランチからPRを作成するようにしてください。

4. **PRタイトルと説明文の作成・提示**

- **PRタイトルのフォーマット**: `{emoji} [{JIRA番号}][{attributes}] {title}`
    - 先頭に絵文字を付ける（以下から選択）：
        - `:sparkles:` - 新機能
        - `:bug:` - バグ修正
        - `:memo:` - ドキュメント変更
        - `:recycle:` - リファクタリング
        - `:fire:` - コード削除
        - `:wrench:` - ビルド/ツール変更
        - `:zap:` - パフォーマンス改善
        - `:art:` - コードスタイル/フォーマット
        - `:lock:` - セキュリティ修正
        - `:package:` - 依存関係更新
    - `[JIRA番号]` - Jiraチケット番号がある場合（例: `[KWS-12345]`）
    - `[attributes]` - 影響範囲や属性（例: `[frontend]`, `[backend]`, `[infra]`）
    - `{title}` - 変更の概要

- **PR説明**：
    - なぜ変更が行われたのか、何を行うのか、関連するコンテキストを含めてください
    - 実装の詳細は記述しないでください
    - `##`ヘッダーを使ってセクションを整理するMarkdown構造を使用してください
    - プロフェッショナルでありながらややカジュアルなトーンで自然に書いてください

5. **ユーザー確認後のプルリクエスト作成/更新**

ブランチがまだプッシュされていない場合は、先に`git push -u origin <branch-name>`でプッシュしてください。

PR説明文（body）は必ず一時ファイルに書き出してから `--body-file` で渡してください。`--body` で直接渡すと改行を含む場合に permission request が発生します。

手順:
1. Writeツールで `~/.claude/tmp/pr-body.md` にbodyを書き出す
2. `create-pr.sh` に `--body-file ~/.claude/tmp/pr-body.md` で渡す

### 新規作成の場合

**注意**: `gh pr create`を直接使用しないでください。

```bash
~/.claude/scripts/create-pr.sh create --title "PR_TITLE_HERE" --body-file ~/.claude/tmp/pr-body.md
```


### 更新の場合

**注意**: `gh pr edit`を直接使用しないでください。

```bash
~/.claude/scripts/create-pr.sh edit --title "PR_TITLE_HERE" --body-file ~/.claude/tmp/pr-body.md
```
タイトルのみ、または説明文のみの更新も可能です。


### draftを解除してレビュー可能にする場合

```bash
gh pr ready
```

**注意**: `gh pr create`や`gh pr edit`を直接使用しないでください。

## 重要な注意事項

- **新規PRは必ずdraftモードで作成します。**
- **`--title`や`--body`の値に`$()`によるコマンド置換を埋め込むことは禁止です。** 必ずプレーンな文字列リテラルを直接渡してください。

## PR説明文作成ガイドライン

- **Markdown構造を使用**：PR説明文を「概要」、「背景」、「変更内容」などのセクションに整理するために`##`ヘッダーを使用してください。
- **自然で読みやすい文体**：硬い敬語は避け、親しみやすい現在形（「〜する」「〜できる」「〜したい」）で書く。箇条書きは最小限にして流れのある文章にする。
- **簡潔で要点を絞る**：冗長な説明や詳細すぎる技術的背景は避け、必要な情報だけを含める。背景は「なぜこの変更が必要なのか」を1〜2文で説明する。
